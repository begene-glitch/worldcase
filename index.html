<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¸ê³„ ì—¬í–‰ ê°€ë°© ê¾¸ë¦¬ê¸° - ë¹„ë²„ ì±Œë¦°ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Apple SD Gothic Neo', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #4ECDC4;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 18px;
            font-weight: bold;
        }

        .beaver-intro {
            background: #FFF3CD;
            border: 3px solid #F0AD4E;
            border-radius: 15px;
            padding: 25px;
            margin: 20px;
            position: relative;
            font-size: 22px;
            line-height: 1.4;
            text-align: center;
        }

        .main-content {
            display: flex;
            padding: 20px;
            gap: 30px;
        }

        .gifts-section {
            flex: 1;
            background: #F8F9FA;
            border-radius: 15px;
            padding: 20px;
        }

        .gifts-section h3 {
            color: #495057;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .gifts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .gift-item {
            background: white;
            border: 3px solid #DEE2E6;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .gift-item:hover, .gift-item:active {
            transform: translateY(-5px);
            border-color: #4ECDC4;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .gift-item.selected {
            border-color: #FF6B6B;
            background: #FFF5F5;
            transform: scale(0.95);
        }

        .gift-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .gift-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .gift-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .gift-length {
            color: #FF6B6B;
            font-weight: bold;
            font-size: 18px;
        }

        .bag-section {
            flex: 1;
            background: #E3F2FD;
            border-radius: 15px;
            padding: 20px;
        }

        .bag-title {
            text-align: center;
            color: #1976D2;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: bold;
        }

        .bag-container {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            border: 4px solid #654321;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .bag-container::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 20px;
            background: #654321;
            border-radius: 20px 20px 0 0;
            border: 3px solid #4A2C17;
        }

        .bag-container::after {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 12px;
            background: #4A2C17;
            border-radius: 15px;
        }

        .bag-zipper {
            position: absolute;
            top: 15px;
            left: 20px;
            right: 20px;
            height: 4px;
            background: #FFD700;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .bag-zipper::before {
            content: '';
            position: absolute;
            right: 15px;
            top: -4px;
            width: 12px;
            height: 12px;
            background: #FFD700;
            border-radius: 50%;
            border: 2px solid #FFA500;
        }

        .bag-slots {
            display: flex;
            flex-direction: row;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 25px;
        }

        .bag-slot {
            width: 120px;
            height: 100px;
            border: 3px dashed #D4B08A;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        .bag-slot:hover, .bag-slot:active {
            border-color: #4ECDC4;
            background: rgba(78, 205, 196, 0.2);
        }

        .bag-slot.drag-over {
            border-color: #4ECDC4;
            background: rgba(78, 205, 196, 0.2);
        }

        .bag-slot.filled {
            border-color: #28A745;
            background: rgba(40, 167, 69, 0.1);
        }

        .slot-number {
            position: absolute;
            top: -15px;
            left: -15px;
            background: #FF6B6B;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .bag-slot .gift-in-bag {
            text-align: center;
        }

        .bag-slot .gift-in-bag .gift-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .bag-slot .gift-in-bag .gift-length {
            font-size: 12px;
        }

        .status-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #DEE2E6;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #E9ECEF;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28A745, #20C997);
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill.over-limit {
            background: linear-gradient(45deg, #DC3545, #FD7E14);
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
        }

        .btn-help {
            background: #6C757D;
            color: white;
        }

        .btn-help:hover {
            background: #5A6268;
            transform: translateY(-2px);
        }

        .btn-check {
            background: #28A745;
            color: white;
        }

        .btn-check:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-reset {
            background: #FFC107;
            color: #212529;
        }

        .btn-reset:hover {
            background: #E0A800;
            transform: translateY(-2px);
        }

        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message.success {
            background: #28A745;
        }

        .message.error {
            background: #DC3545;
        }

        .message.show {
            opacity: 1;
        }

        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .help-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
        }

        .help-content h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .help-content ul {
            text-align: left;
            margin: 20px 0;
        }

        .reflection-panel {
            background: #FFF8DC;
            border: 3px solid #F0AD4E;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .reflection-panel.show {
            display: block;
        }

        .reflection-title {
            color: #D2691E;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .reflection-question {
            margin-bottom: 15px;
            font-size: 16px;
            color: #495057;
        }

        .reflection-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #DEE2E6;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .reflection-input:focus {
            outline: none;
            border-color: #4ECDC4;
        }

        .final-submit-btn {
            background: #FF6B6B;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            width: 100%;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .final-submit-btn:hover {
            background: #FF5252;
            transform: translateY(-2px);
        }

        .feedback {
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
            display: block;
        }

        .feedback.incorrect {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
            display: block;
        }

        .feedback.complete {
            background: #D1ECF1;
            color: #0C5460;
            border: 1px solid #BEE5EB;
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .gifts-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .bag-slots {
                flex-direction: row;
                justify-content: center;
                gap: 10px;
            }
            
            .bag-slot {
                width: 80px;
                height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ ì„¸ê³„ ì—¬í–‰ ê°€ë°© ê¾¸ë¦¬ê¸° ëŒ€ì‘ì „! ğŸ’</h1>
            <p>ë¹„ë²„ ê°œìš´ì´ì™€ í•¨ê»˜ ì„¸ê³„ ê°êµ­ì˜ ì„ ë¬¼ì„ ê°€ë°©ì— ë‹´ì•„ë³´ì„¸ìš”!</p>
        </div>

        <div class="beaver-intro">
            <div style="display: inline-block; width: 100%;">
                ì•ˆë…•, ì¹œêµ¬ë“¤! ë‚˜ëŠ” ìš©ê°í•œ ì—¬í–‰ê°€ ë¹„ë²„ ê°œìš´ì´ì•¼!<br>
                ë‚´ ì—¬í–‰ ê°€ë°© ê¸¸ì´ëŠ” <strong style="color: #FF6B6B;">30cm</strong>ì¸ë°, ì„ ë¬¼ <strong style="color: #FF6B6B;">3ê°œ</strong>ë¥¼ ë‹´ê³  ì‹¶ì–´!<br>
                ì„ ë¬¼ë“¤ì˜ ì´ ê¸¸ì´ê°€ ì—¬í–‰ ê°€ë°© ê¸¸ì´ì— ê°€ì¥ ê°€ê¹ë„ë¡ ë„ì™€ì¤„ ìˆ˜ ìˆë‹ˆ?
            </div>
        </div>

        <div class="main-content">
            <div class="gifts-section">
                <h3>ğŸ ì„¸ê³„ ê°êµ­ì˜ ë©‹ì§„ ì„ ë¬¼ë“¤</h3>
                <div class="gifts-grid" id="giftsGrid">
                    <!-- ì„ ë¬¼ë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <div class="bag-section">
                <div class="bag-title">ğŸ’ ë‚˜ì˜ ì—¬í–‰ ê°€ë°© (ìµœëŒ€ 30cm, ë¬¼ê±´ 3ê°œ)</div>
                
                <div class="bag-container">
                    <div class="bag-zipper"></div>
                    <div class="bag-slots" id="bagSlots">
                        <div class="bag-slot" data-slot="0">
                            <div class="slot-number">1</div>
                            <div class="placeholder">ì²« ë²ˆì§¸<br>ì„ ë¬¼</div>
                        </div>
                        <div class="bag-slot" data-slot="1">
                            <div class="slot-number">2</div>
                            <div class="placeholder">ë‘ ë²ˆì§¸<br>ì„ ë¬¼</div>
                        </div>
                        <div class="bag-slot" data-slot="2">
                            <div class="slot-number">3</div>
                            <div class="placeholder">ì„¸ ë²ˆì§¸<br>ì„ ë¬¼</div>
                        </div>
                    </div>
                </div>

                <div class="status-panel">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-help" onclick="showHelp()">ğŸ’¡ ë„ì›€ë§</button>
                        <button class="btn btn-check" onclick="checkAnswer()">âœ… ê²°ê³¼ í™•ì¸</button>
                        <button class="btn btn-reset" onclick="resetBag()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
                    </div>
                </div>

                <div class="reflection-panel" id="reflectionPanel">
                    <div class="reflection-title">ğŸ¤” ìƒê°í•´ë³´ê¸°</div>
                    
                    <div class="reflection-question">
                        <strong>ì„ ë¬¼ 3ê°€ì§€ì˜ ì´ ê¸¸ì´ëŠ” ëª‡ cmì¸ê°€ìš”?</strong><br>
                        ë‹µ: <input type="text" class="reflection-input" id="totalLengthAnswer" oninput="checkTotalLength()" onblur="checkTotalLength()"> cm
                        <div class="feedback" id="totalLengthFeedback"></div>
                    </div>
                    
                    <div class="reflection-question">
                        <strong>ë‚´ ì—¬í–‰ ê°€ë°© ê¸¸ì´ 30cmì—ì„œ ë‚¨ì€ ê³µê°„ì€ ëª‡ cm ì¸ê°€ìš”?</strong><br>
                        ë‹µ: <input type="text" class="reflection-input" id="remainingSpaceAnswer" oninput="checkRemainingSpace()" onblur="checkRemainingSpace()"> cm
                        <div class="feedback" id="remainingSpaceFeedback"></div>
                    </div>
                    
                    <div class="reflection-question">
                        <strong>ì´ ì„ íƒì— ë§Œì¡±í•˜ë‚˜ìš”? ë” ì¢‹ì€ ë‹µì´ ìˆë‹¤ë©´ ë¬´ì—‡ì¼ê¹Œìš”?</strong><br>
                        ë‹µ: <input type="text" class="reflection-input" id="satisfactionAnswer" oninput="checkSatisfaction()" onblur="checkSatisfaction()">
                        <div class="feedback" id="satisfactionFeedback"></div>
                    </div>
                    
                    <button class="final-submit-btn" onclick="finalSubmit()" id="finalSubmitBtn" disabled>
                        ğŸ¯ ë‚˜ì˜ ìµœì¢… ì„ íƒ ì œì¶œí•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="message" id="message"></div>

    <div class="help-modal" id="helpModal">
        <div class="help-content">
            <h3>ğŸ¤” ì–´ë–»ê²Œ í•˜ëŠ” ê±´ê°€ìš”?</h3>
            <ul>
                <li>ğŸ ì™¼ìª½ì— ìˆëŠ” ì„ ë¬¼ì„ ë§ˆìš°ìŠ¤ë¡œ í´ë¦­í•˜ê³  ëŒì–´ì„œ ì˜¤ë¥¸ìª½ ê°€ë°©ì— ë„£ì–´ë³´ì„¸ìš”!</li>
                <li>ğŸ“ ì„ ë¬¼ë“¤ì˜ ì´ ê¸¸ì´ê°€ 30cmë¥¼ ë„˜ì§€ ì•Šì•„ì•¼ í•´ìš”!</li>
                <li>ğŸ”¢ ê°€ë°©ì—ëŠ” ì •í™•íˆ 3ê°œì˜ ì„ ë¬¼ë§Œ ë“¤ì–´ê°€ì•¼ í•´ìš”!</li>
                <li>âœ¨ ê°€ì¥ íš¨ìœ¨ì ì¸ ì¡°í•©ì„ ì°¾ì•„ë³´ì„¸ìš”!</li>
            </ul>
            <button class="btn btn-help" onclick="hideHelp()">ì•Œì•˜ì–´ìš”!</button>
        </div>
    </div>

    <script>
        // ì„ ë¬¼ ë°ì´í„°
        const gifts = [
            {id: 1, name: "í”„ë‘ìŠ¤ì˜ ë°”ê²ŒíŠ¸ ëª¨í˜•", length: 5, icon: "ğŸ¥–", country: "í”„ë‘ìŠ¤"},
            {id: 2, name: "ê°€ë‚˜ì˜ ì´ˆì½œë¦¿", length: 12, icon: "ğŸ«", country: "ê°€ë‚˜"},
            {id: 3, name: "ë¸Œë¼ì§ˆì˜ ì¶•êµ¬ê³µ", length: 8, icon: "âš½", country: "ë¸Œë¼ì§ˆ"},
            {id: 4, name: "ì¸ë„ì˜ ì½”ë¼ë¦¬ ì¸í˜•", length: 15, icon: "ğŸ˜", country: "ì¸ë„"},
            {id: 5, name: "ë¯¸êµ­ì˜ ììœ ì˜ ì—¬ì‹ ìƒ", length: 10, icon: "ğŸ—½", country: "ë¯¸êµ­"},
            {id: 6, name: "ì¤‘êµ­ì˜ íŒë‹¤ ì¸í˜•", length: 7, icon: "ğŸ¼", country: "ì¤‘êµ­"},
            {id: 7, name: "ë©•ì‹œì½”ì˜ íƒ€ì½” ëª¨í˜•", length: 6, icon: "ğŸŒ®", country: "ë©•ì‹œì½”"},
            {id: 8, name: "ì˜êµ­ì˜ ëŸ°ë˜ ë²„ìŠ¤", length: 9, icon: "ğŸšŒ", country: "ì˜êµ­"},
            {id: 9, name: "ì´íƒˆë¦¬ì•„ì˜ í”¼ì ëª¨í˜•", length: 11, icon: "ğŸ•", country: "ì´íƒˆë¦¬ì•„"}
        ];

        let bagContents = [null, null, null];
        let totalLength = 0;

        // ê°œë³„ ë‹µì•ˆ ê²€ì¦ í•¨ìˆ˜ë“¤ (ìµœìš°ì„  ì •ì˜)
        function checkTotalLength() {
            const input = document.getElementById('totalLengthAnswer');
            const feedback = document.getElementById('totalLengthFeedback');
            
            if (!input || !feedback) return false;
            
            const value = input.value.trim();
            
            if (!value) {
                feedback.style.display = 'none';
                updateSubmitButton();
                return false;
            }
            
            const selectedGifts = bagContents.filter(gift => gift !== null);
            const actualTotalLength = selectedGifts.reduce((sum, gift) => sum + gift.length, 0);
            const studentAnswer = parseInt(value);
            
            if (studentAnswer === actualTotalLength) {
                feedback.className = 'feedback correct';
                feedback.textContent = 'âœ… ì •ë‹µì´ì—ìš”! ê³„ì‚°ì„ ì •í™•íˆ í–ˆì–´ìš”!';
                updateSubmitButton();
                return true;
            } else {
                feedback.className = 'feedback incorrect';
                const giftLengths = selectedGifts.map(gift => gift.length).join(' + ');
                feedback.textContent = `âŒ ë‹¤ì‹œ ê³„ì‚°í•´ë³´ì„¸ìš”! íŒíŠ¸: ${giftLengths} = ${actualTotalLength}cm`;
                updateSubmitButton();
                return false;
            }
        }

        function checkRemainingSpace() {
            const input = document.getElementById('remainingSpaceAnswer');
            const feedback = document.getElementById('remainingSpaceFeedback');
            
            if (!input || !feedback) return false;
            
            const value = input.value.trim();
            
            if (!value) {
                feedback.style.display = 'none';
                updateSubmitButton();
                return false;
            }
            
            const selectedGifts = bagContents.filter(gift => gift !== null);
            const actualTotalLength = selectedGifts.reduce((sum, gift) => sum + gift.length, 0);
            const actualRemainingSpace = 30 - actualTotalLength;
            const studentAnswer = parseInt(value);
            
            if (studentAnswer === actualRemainingSpace) {
                feedback.className = 'feedback correct';
                feedback.textContent = 'âœ… ì •ë‹µì´ì—ìš”! ë¹¼ê¸° ê³„ì‚°ì„ ì •í™•íˆ í–ˆì–´ìš”!';
                updateSubmitButton();
                return true;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = `âŒ ë‹¤ì‹œ ê³„ì‚°í•´ë³´ì„¸ìš”! íŒíŠ¸: 30cm - ${actualTotalLength}cm = ${actualRemainingSpace}cm`;
                updateSubmitButton();
                return false;
            }
        }

        function checkSatisfaction() {
            const input = document.getElementById('satisfactionAnswer');
            const feedback = document.getElementById('satisfactionFeedback');
            
            if (!input || !feedback) return false;
            
            const value = input.value.trim();
            
            if (!value) {
                feedback.style.display = 'none';
                updateSubmitButton();
                return false;
            }
            
            if (value.length >= 5) {
                feedback.className = 'feedback complete';
                feedback.textContent = 'âœ… ì¢‹ì€ ìƒê°ì´ì—ìš”! ìì‹ ì˜ ì˜ê²¬ì„ ì˜ í‘œí˜„í–ˆì–´ìš”!';
                updateSubmitButton();
                return true;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = 'ğŸ’­ ì¡°ê¸ˆ ë” ìì„¸íˆ ì¨ë³´ì„¸ìš”! ì–´ë–¤ ìƒê°ì¸ì§€ ê¶ê¸ˆí•´ìš”!';
                updateSubmitButton();
                return false;
            }
        }

        function updateSubmitButton() {
            const totalInput = document.getElementById('totalLengthAnswer');
            const remainingInput = document.getElementById('remainingSpaceAnswer');
            const satisfactionInput = document.getElementById('satisfactionAnswer');
            const submitBtn = document.getElementById('finalSubmitBtn');
            
            if (!totalInput || !remainingInput || !satisfactionInput || !submitBtn) return;
            
            // ê° ë‹µì˜ ìƒíƒœë¥¼ ë‹¨ìˆœíˆ í™•ì¸
            const totalValue = totalInput.value.trim();
            const remainingValue = remainingInput.value.trim();
            const satisfactionValue = satisfactionInput.value.trim();
            
            // ì‹¤ì œ ì •ë‹µ ê³„ì‚°
            const selectedGifts = bagContents.filter(gift => gift !== null);
            const actualTotalLength = selectedGifts.reduce((sum, gift) => sum + gift.length, 0);
            const actualRemainingSpace = 30 - actualTotalLength;
            
            // ê° ë‹µì´ ì •í™•í•œì§€ í™•ì¸
            const totalCorrect = totalValue && parseInt(totalValue) === actualTotalLength;
            const remainingCorrect = remainingValue && parseInt(remainingValue) === actualRemainingSpace;
            const satisfactionComplete = satisfactionValue && satisfactionValue.length >= 5;
            
            if (totalCorrect && remainingCorrect && satisfactionComplete) {
                submitBtn.disabled = false;
                submitBtn.style.background = '#FF6B6B';
            } else {
                submitBtn.disabled = true;
                submitBtn.style.background = '#CCC';
            }
        }

        // ì „ì—­ ë³€ìˆ˜ ì¶”ê°€
        let selectedGift = null;
        let isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // ì„ ë¬¼ ê·¸ë¦¬ë“œ ìƒì„±
        function createGiftsGrid() {
            const grid = document.getElementById('giftsGrid');
            gifts.forEach(gift => {
                const giftElement = document.createElement('div');
                giftElement.className = 'gift-item';
                giftElement.draggable = !isMobile; // ëª¨ë°”ì¼ì—ì„œëŠ” ë“œë˜ê·¸ ë¹„í™œì„±í™”
                giftElement.dataset.giftId = gift.id;
                giftElement.innerHTML = `
                    <div class="gift-icon">${gift.icon}</div>
                    <div class="gift-name">${gift.name}</div>
                    <div class="gift-length">${gift.length}cm</div>
                `;
                
                // ë°ìŠ¤í¬í†± ì´ë²¤íŠ¸
                if (!isMobile) {
                    giftElement.addEventListener('dragstart', handleDragStart);
                    giftElement.addEventListener('dragend', handleDragEnd);
                }
                
                // ëª¨ë°”ì¼/í´ë¦­ ì´ë²¤íŠ¸
                giftElement.addEventListener('click', handleGiftClick);
                giftElement.addEventListener('touchstart', handleGiftClick);
                
                grid.appendChild(giftElement);
            });
        }

        // ëª¨ë°”ì¼/í´ë¦­ìš© ì„ ë¬¼ ì„ íƒ
        function handleGiftClick(e) {
            e.preventDefault();
            const giftId = parseInt(e.currentTarget.dataset.giftId);
            
            // ì´ë¯¸ ê°€ë°©ì— ìˆëŠ” ì„ ë¬¼ì¸ì§€ í™•ì¸
            for (let i = 0; i < bagContents.length; i++) {
                if (bagContents[i] && bagContents[i].id === giftId) {
                    showMessage('ì´ë¯¸ ê°€ë°©ì— ë“¤ì–´ìˆëŠ” ì„ ë¬¼ì´ì—ìš”!', 'error');
                    return;
                }
            }
            
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.gift-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // í˜„ì¬ ì„ ë¬¼ ì„ íƒ
            e.currentTarget.classList.add('selected');
            selectedGift = giftId;
            
            if (isMobile) {
                showMessage('ì„ ë¬¼ì„ ì„ íƒí–ˆì–´ìš”! ì´ì œ ê°€ë°©ì˜ ë¹ˆ ì¹¸ì„ í„°ì¹˜í•˜ì„¸ìš”!', 'success');
            }
        }

        // ê°€ë°© ìŠ¬ë¡¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupBagSlots() {
            const slots = document.querySelectorAll('.bag-slot');
            slots.forEach(slot => {
                // ë°ìŠ¤í¬í†± ë“œë˜ê·¸ì•¤ë“œë¡­
                if (!isMobile) {
                    slot.addEventListener('dragover', handleDragOver);
                    slot.addEventListener('drop', handleDrop);
                    slot.addEventListener('dragleave', handleDragLeave);
                }
                
                // ëª¨ë°”ì¼/í´ë¦­ ì´ë²¤íŠ¸
                slot.addEventListener('click', handleSlotClick);
                slot.addEventListener('touchstart', handleSlotClick);
            });
        }

        // ë“œë˜ê·¸ ì‹œì‘
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.giftId);
            e.target.classList.add('dragging');
        }

        // ë“œë˜ê·¸ ë
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // ë“œë˜ê·¸ ì˜¤ë²„
        function handleDragOver(e) {
            e.preventDefault();
            e.target.closest('.bag-slot').classList.add('drag-over');
        }

        // ë“œë˜ê·¸ ë– ë‚¨
        function handleDragLeave(e) {
            e.target.closest('.bag-slot').classList.remove('drag-over');
        }

        // ë“œë¡­ ì²˜ë¦¬
        function handleDrop(e) {
            e.preventDefault();
            const slot = e.target.closest('.bag-slot');
            slot.classList.remove('drag-over');
            
            const giftId = parseInt(e.dataTransfer.getData('text/plain'));
            const slotIndex = parseInt(slot.dataset.slot);
            
            addGiftToBag(giftId, slotIndex);
        }

        // ìŠ¬ë¡¯ í´ë¦­ (ë¹„ìš°ê¸° ë˜ëŠ” ëª¨ë°”ì¼ìš© ë„£ê¸°)
        function handleSlotClick(e) {
            e.preventDefault();
            const slot = e.target.closest('.bag-slot');
            const slotIndex = parseInt(slot.dataset.slot);
            
            // ëª¨ë°”ì¼ì—ì„œ ì„ ë¬¼ì´ ì„ íƒëœ ìƒíƒœë¼ë©´ ë„£ê¸°
            if (selectedGift && bagContents[slotIndex] === null) {
                addGiftToBag(selectedGift, slotIndex);
                
                // ì„ íƒ ìƒíƒœ í•´ì œ
                document.querySelectorAll('.gift-item').forEach(item => {
                    item.classList.remove('selected');
                });
                selectedGift = null;
                return;
            }
            
            // ì´ë¯¸ ì„ ë¬¼ì´ ìˆë‹¤ë©´ ë¹„ìš°ê¸°
            if (bagContents[slotIndex] !== null) {
                removeGiftFromBag(slotIndex);
                
                // ì„ íƒ ìƒíƒœ í•´ì œ
                document.querySelectorAll('.gift-item').forEach(item => {
                    item.classList.remove('selected');
                });
                selectedGift = null;
            }
        }

        // ê°€ë°©ì— ì„ ë¬¼ ì¶”ê°€
        function addGiftToBag(giftId, slotIndex) {
            const gift = gifts.find(g => g.id === giftId);
            const slot = document.querySelector(`[data-slot="${slotIndex}"]`);
            
            // ì´ë¯¸ ë‹¤ë¥¸ ìŠ¬ë¡¯ì— ìˆëŠ” ì„ ë¬¼ì¸ì§€ í™•ì¸
            for (let i = 0; i < bagContents.length; i++) {
                if (bagContents[i] && bagContents[i].id === giftId) {
                    showMessage('ì´ë¯¸ ê°€ë°©ì— ë“¤ì–´ìˆëŠ” ì„ ë¬¼ì´ì—ìš”!', 'error');
                    return;
                }
            }
            
            // ìŠ¬ë¡¯ì´ ì´ë¯¸ ì°¨ìˆë‹¤ë©´ ê¸°ì¡´ ì„ ë¬¼ ì œê±°
            if (bagContents[slotIndex] !== null) {
                removeGiftFromBag(slotIndex);
            }
            
            bagContents[slotIndex] = gift;
            slot.classList.add('filled');
            slot.innerHTML = `
                <div class="slot-number">${slotIndex + 1}</div>
                <div class="gift-in-bag">
                    <div class="gift-icon">${gift.icon}</div>
                    <div class="gift-length">${gift.length}cm</div>
                </div>
            `;
            
            updateTotalLength();
        }

        // ê°€ë°©ì—ì„œ ì„ ë¬¼ ì œê±°
        function removeGiftFromBag(slotIndex) {
            const slot = document.querySelector(`[data-slot="${slotIndex}"]`);
            bagContents[slotIndex] = null;
            slot.classList.remove('filled');
            slot.innerHTML = `
                <div class="slot-number">${slotIndex + 1}</div>
                <div class="placeholder">${['ì²« ë²ˆì§¸', 'ë‘ ë²ˆì§¸', 'ì„¸ ë²ˆì§¸'][slotIndex]}<br>ì„ ë¬¼</div>
            `;
            
            updateTotalLength();
        }

        // ì´ ê¸¸ì´ ì—…ë°ì´íŠ¸
        function updateTotalLength() {
            totalLength = bagContents.reduce((sum, gift) => {
                return sum + (gift ? gift.length : 0);
            }, 0);
            
            const progressFill = document.getElementById('progressFill');
            const percentage = Math.min((totalLength / 30) * 100, 100);
            progressFill.style.width = percentage + '%';
            
            if (totalLength > 30) {
                progressFill.classList.add('over-limit');
            } else {
                progressFill.classList.remove('over-limit');
            }
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswer() {
            const filledSlots = bagContents.filter(gift => gift !== null).length;
            
            if (filledSlots !== 3) {
                showMessage('ê°€ë°©ì— ì„ ë¬¼ì„ 3ê°œ ë„£ì–´ì•¼ í•´ìš”!', 'error');
                return;
            }
            
            if (totalLength > 30) {
                showMessage('ì•„ì‰½ì§€ë§Œ ì´ ê¸¸ì´ê°€ 30cmë¥¼ ë„˜ì—ˆì–´ìš”! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!', 'error');
                return;
            }
            
            showMessage('ğŸ‰ ì¶•í•˜í•´ìš”! ê°œìš´ì´ì˜ ê°€ë°©ì— ì„ ë¬¼ì„ ëª¨ë‘ ë‹´ì•˜ì–´ìš”! ì´ì œ ìƒê°í•´ë³´ê¸°ë¥¼ í•´ë³´ì„¸ìš”!', 'success');
            
            // ìƒê°í•´ë³´ê¸° íŒ¨ë„ í‘œì‹œ
            document.getElementById('reflectionPanel').classList.add('show');
        }

        // ìµœì¢… ì œì¶œ (ë‹¨ìˆœí™”)
        function finalSubmit() {
            const selectedGifts = bagContents.filter(gift => gift !== null);
            const actualTotalLength = selectedGifts.reduce((sum, gift) => sum + gift.length, 0);
            const actualRemainingSpace = 30 - actualTotalLength;
            
            let feedbackMessage = 'ğŸ‰ ëª¨ë“  ê³„ì‚°ì„ ì •í™•íˆ ì™„ë£Œí–ˆì–´ìš”! í›Œë¥­í•´ìš”!\n\n';
            
            if (actualRemainingSpace === 0) {
                feedbackMessage += 'ğŸŒŸğŸ‰ ì™€! ì •ë§ ëŒ€ë‹¨í•´ìš”! ê°€ë°©ì„ ë”± 30cmë¡œ ì™„ë²½í•˜ê²Œ ì±„ì› ì–´ìš”! ë‹¹ì‹ ì€ ì§„ì •í•œ ì—¬í–‰ ì „ë¬¸ê°€ì˜ˆìš”! ğŸ†âœ¨';
            } else if (actualRemainingSpace <= 2) {
                feedbackMessage += `ğŸ¯ ì •ë§ ì˜í–ˆì–´ìš”! ë‚¨ì€ ê³µê°„ì´ ${actualRemainingSpace}cmë°–ì— ì•ˆ ë˜ë„¤ìš”! ê±°ì˜ ì™„ë²½í•´ìš”! ğŸ‘`;
            } else if (actualRemainingSpace <= 5) {
                feedbackMessage += `ğŸ˜Š ì¢‹ì€ ì„ íƒì´ì—ìš”! ë‚¨ì€ ê³µê°„ì€ ${actualRemainingSpace}cmì˜ˆìš”. ì¡°ê¸ˆ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì±„ìš¸ ìˆ˜ë„ ìˆê² ì–´ìš”! ğŸ’ª`;
            } else {
                feedbackMessage += `ğŸ¤” ë‚¨ì€ ê³µê°„ì´ ${actualRemainingSpace}cmë‚˜ ìˆì–´ìš”! ë” í° ì„ ë¬¼ì´ë‚˜ ë‹¤ë¥¸ ì¡°í•©ì„ ì‹œë„í•´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”? ğŸ`;
            }
            
            showLongMessage(feedbackMessage);
            
            // ì…ë ¥ í•„ë“œë“¤ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§Œë“¤ê¸°
            const totalInput = document.getElementById('totalLengthAnswer');
            const remainingInput = document.getElementById('remainingSpaceAnswer');
            const satisfactionInput = document.getElementById('satisfactionAnswer');
            const submitBtn = document.querySelector('.final-submit-btn');
            
            if (totalInput) totalInput.readOnly = true;
            if (remainingInput) remainingInput.readOnly = true;
            if (satisfactionInput) satisfactionInput.readOnly = true;
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'âœ… ì œì¶œ ì™„ë£Œ!';
            }
        }

        // ê¸´ ë©”ì‹œì§€ í‘œì‹œ (5ì´ˆê°„)
        function showLongMessage(text) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = 'message success';
            message.classList.add('show');
            
            setTimeout(() => {
                message.classList.remove('show');
            }, 5000);
        }

        // ê°€ë°© ë¦¬ì…‹
        function resetBag() {
            for (let i = 0; i < 3; i++) {
                removeGiftFromBag(i);
            }
            
            // ìƒê°í•´ë³´ê¸° íŒ¨ë„ ìˆ¨ê¸°ê¸°
            const reflectionPanel = document.getElementById('reflectionPanel');
            if (reflectionPanel) {
                reflectionPanel.classList.remove('show');
            }
            
            // ì…ë ¥ í•„ë“œë“¤ ì´ˆê¸°í™”
            const totalInput = document.getElementById('totalLengthAnswer');
            const remainingInput = document.getElementById('remainingSpaceAnswer');
            const satisfactionInput = document.getElementById('satisfactionAnswer');
            const submitBtn = document.querySelector('.final-submit-btn');
            
            if (totalInput) {
                totalInput.value = '';
                totalInput.readOnly = false;
            }
            if (remainingInput) {
                remainingInput.value = '';
                remainingInput.readOnly = false;
            }
            if (satisfactionInput) {
                satisfactionInput.value = '';
                satisfactionInput.readOnly = false;
            }
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ¯ ë‚˜ì˜ ìµœì¢… ì„ íƒ ì œì¶œí•˜ê¸°';
            }
            
            // í”¼ë“œë°± ìˆ¨ê¸°ê¸°
            const feedbacks = document.querySelectorAll('.feedback');
            feedbacks.forEach(feedback => {
                feedback.style.display = 'none';
            });
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.classList.add('show');
            
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }

        // ë„ì›€ë§ í‘œì‹œ
        function showHelp() {
            document.getElementById('helpModal').style.display = 'flex';
        }

        // ë„ì›€ë§ ìˆ¨ê¸°ê¸°
        function hideHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // ì´ˆê¸°í™”
        function init() {
            createGiftsGrid();
            setupBagSlots();
            updateTotalLength();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', init);
    </script>
</body>
</html>